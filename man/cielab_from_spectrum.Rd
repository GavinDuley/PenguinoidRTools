% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cielab.funct.R
\name{cielab_from_spectrum}
\alias{cielab_from_spectrum}
\title{Convert spectrophotometry data to CIELab colour values}
\usage{
cielab_from_spectrum(data, sample_col = NULL, path_mm = 10)
}
\arguments{
\item{data}{A data.frame containing spectroscopy data in either wide or long format}

\item{sample_col}{Character name of the column to group samples by. This controls
how results are aggregated:
\itemize{
  \item Use "WineName" to get one result per wine (averages replicates)
  \item Use "Replicate" to get one result per replicate (no averaging)
}
Default: auto-detects "WineName", "sample_name", "Sample", or first column.}

\item{path_mm}{Numeric optical path length in millimeters (default: 10)}
}
\value{
A data.frame with one row per unique value of sample_col, containing:
  \describe{
    \item{<sample_col>}{The sample identifier (uses original column name)}
    \item{CIELab_L}{L* lightness (0-100)}
    \item{CIELab_a}{a* green-red axis}
    \item{CIELab_b}{b* blue-yellow axis}
    \item{CIELab_C}{Chroma (saturation)}
    \item{CIELab_H}{Hue angle in degrees (0-360)}
  }
}
\description{
Calculates CIELab colour coordinates from spectrophotometry transmission
data using the OIV-MA-AS2-11 (R2006) method with D65 illuminant and
10 degree standard observer.
}
\details{
This function accepts data in two formats:
\enumerate{
  \item \strong{Wide format}: Columns like X780, X779, ... X380 with transmission values,
        plus an identifier column (e.g., WineName, Sample, etc.)
  \item \strong{Long format}: Columns for sample ID, lambda (wavelength), and T (transmission)
}


The function automatically detects the data format:
\itemize{
  \item \strong{Wide format}: Has columns starting with "X" followed by numbers (e.g., X780, X500)
  \item \strong{Long format}: Has columns named "lambda" and "T"
}

Transmission values should be fractions (0-1), not percentages. Small values
slightly > 1 (e.g., 1.003) are normal instrument noise and ignored. Values
significantly > 1 (> 1.1) trigger a warning - use
\code{cielab_spectroscopy_percentage_to_fraction()} to convert percentages.
}
\examples{
# Wide format example
wide_data <- data.frame(
  WineName = c("Sample1", "Sample2"),
  X780 = c(0.95, 0.80),
  X700 = c(0.90, 0.75),
  X600 = c(0.85, 0.70),
  X500 = c(0.80, 0.65),
  X400 = c(0.75, 0.60),
  X380 = c(0.70, 0.55)
)
# result <- cielab_from_spectrum(wide_data)

# Long format example
long_data <- data.frame(
  WineName = rep(c("Sample1", "Sample2"), each = 81),
  lambda = rep(seq(380, 780, by = 5), 2),
  T = runif(162, 0.5, 1.0)
)
# result <- cielab_from_spectrum(long_data)

# Control grouping with sample_col:
# - Default uses WineName -> averages replicates together
# result <- cielab_from_spectrum(data)

# - Use Replicate to get individual results per replicate
# result <- cielab_from_spectrum(data, sample_col = "Replicate")

}
